<div *ngIf="isOpen" class="flex-column kukai-modal">
  <div class="content">
    <div class="flex-column top">
      <img class="flex-row button close" (click)="closeModalAction()" src="../../../assets/img/close-btn-x.png" />
      <h1 class="title">Confirmation</h1>
    </div>
    <div class="flex-column confirm-send">
      <div class="flex-row top">
        <div class="flex-column left">
          <span *ngIf="!tokenBalanceService.isNFT(token)" class="key">AMOUNT TO SEND:</span>
          <img class="token-image"
            [src]="token?.thumbnailUrl || token?.displayUrl || '../../../assets/img/tezos-xtz-logo.svg'"
            [style.object-fit]="token?.displayUrl?.indexOf('.svg') === -1 || token?.thumbnailUrl?.indexOf('.svg') === -1 ? 'cover' : 'scale-down'"
            [class.balance]="!tokenBalanceService.isNFT(token)">
        </div>
        <div class="flex-column right">
          <span class="amount-tez value">{{ formatAmount(token, totalAmount(),
            false)
            }}</span>
          <div class="flex-column">
            <ng-container *ngIf="!tokenTransfer"><span class="amount-usd key">USD: <span class="value">{{'$' +
                  (totalAmount()
                  *
                  walletService.wallet.XTZrate | number:'1.0-2')
                  }}</span></span>
            </ng-container>
            <span *ngIf="tokenBalanceService.isNFT(token)" class="amount-quantity key">QUANTITY:&nbsp;&nbsp;<span
                class="value">{{ getQuantity(totalAmount())
                }}</span></span>
            <span class="key">FEE:&nbsp;&nbsp;<span class="value">{{ (getTotalFee() | number:'1.0-6') + ' tez'
                }}</span></span>
            <span *ngIf="getTotalBurn() > 0" class="key">STORAGE COST:&nbsp;<span class="value">{{ (totalBurn |
                number:'1.0-6') + ' tez'
                }}</span></span>
          </div>
        </div>
      </div>
      <!--*ngIf="this.walletService.wallet.verifier" -->
      <div class="flex-row from">
        <div class="flex-column left">
          <span class="key">FROM ADDRESS: </span>
        </div>
        <div class="flex-column right"><span *ngIf="!!domain" class="domain">{{ domain }}</span><span class="address">{{
            activeAccount?.address
            }}</span>
        </div>
      </div>
      <div class="flex-row divider">
        <span></span><img class="icon" src="../../../assets/img/send-down-arrow.png" /><span></span>
      </div>
      <div class="flex-row to">
        <div class="flex-column left">
          <span class="key">SEND TO: </span>
        </div>
        <div class="flex-column right">
          <span *ngIf="parameters" class="flex-row single-to"><span>DESTINATION</span><span>AMOUNT</span></span>
          <div class="flex-column" *ngFor="let transaction of transactions; index as i"
            (click)="updateParameters(i, transaction.parameters)">
            <span *ngIf="transaction?.meta && transaction.meta?.verifier" class="flex-row torus-to value"><img
                src="../../../assets/img/{{ transaction.meta.verifier }}-logo.svg" class="icon">
              {{ transaction.meta?.alias }}</span>
            <span class="flex-row single-to" [class.selectable]="transactions.length > 1 && parameters"
              [class.active]="batchParamIndex === i && transactions.length > 1 && parameters"><span
                style="width: 34rem; font-family: 'Roboto Mono';">{{
                transaction?.destination
                }}</span><span *ngIf="parameters" style="width: 3.5rem;">{{ (transaction.amount | number:'1.0-6')
                }}</span></span>
            <p class="previewAttention" *ngIf="tokenTransfer && transaction?.destination.slice(0, 3) === 'KT1'">
              Warning:
              Verify the contract can manage tokens</p>
          </div>
        </div>
      </div>
      <br />
      <br />
      <div *ngIf="parameters" class="key">{{transactions.length === 1 ? 'CONTRACT CALL' + ' ' +
        transaction[0].entrypoint : 'MULTIPLE CONTRACT CALLS'}}</div>
        <app-ui-toggle-advanced [default]="false" (stateChange)="advancedForm = $event"></app-ui-toggle-advanced>
      <div *ngIf="advancedForm" class="advanced-form">
        <ng-container *ngIf="parameters">
          <div class="tabs-container">
            <ul class="flex-row tabs">
              <li class="tab" [class.active]="parametersFormat === 0" (click)="setParametersFormat(0)">Micheline</li>
              <li class="tab" [class.active]="parametersFormat === 1" (click)="setParametersFormat(1)">JSON</li>
            </ul>
          </div>
          <textarea *ngIf="parameters" rows="10" readonly>{{ parametersTextboxDisplay() }}</textarea>
        </ng-container>
        <ng-container *ngIf="headlessMode && (!walletService.isLedgerWallet()) || ledgerError">
          <div class="flex-row">
            <div class="flex-column">
              <label class="label">Gas limit</label>
              <input type="text" class="text" [placeholder]="transactions[0].gasLimit || '0'" (input)="getTotalBurn()"
                [(ngModel)]="customGasLimit">
            </div>
            <div class="flex-column">
              <label class="label">Fee</label>
              <input type="text" class="text" (input)="getTotalBurn()" [placeholder]="getTotalFee() || '0'"
                [(ngModel)]="customFee">
            </div>
          </div>
          <div class="flex-row">
            <div class="flex-column">
              <label class="label">Storage limit</label>
              <input type="text" class="text" (input)="getTotalBurn()" [placeholder]="customStorageLimit || '0'"
                [(ngModel)]="customStorageLimit">
            </div>
            <div class="flex-column">
              <label class="label">Max storage cost</label>
              <input type="text" class="text read-only" [placeholder]="(totalBurn || '0') + ' tez'" tabindex=-1
                readonly>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="flex-column bottom">
        <span [style.visibility]="!pwdInvalid ? 'hidden' : ''" [style.margin]="!pwdInvalid ? '0' : ''" class="label danger">{{ this.pwdInvalid }}</span>
        <span class="label">ENTER YOUR PASSWORD TO CONFIRM:</span>
        <input *ngIf="!walletService.isLedgerWallet() && !walletService.isTorusWallet()" [(ngModel)]="password"
          autocomplete="current-password" placeholder="Password" class="text password" type="password"
          (input)="this.pwdInvalid = ''" (change)="this.pwdInvalid = ''" (keydown.enter)='inject()'>
        <button class="confirm" *ngIf="walletService.isLedgerWallet() && ledgerError; else elseBlock"
          (click)="ledgerRetry()">Sign with
          Ledger</button>
        <ng-template #elseBlock>
          <button class="confirm" (click)="inject()"
            [disabled]="walletService.isLedgerWallet() && (!sendResponse || !sendResponse.payload || !sendResponse.payload.signedOperation)">
            {{ walletService.isLedgerWallet() ? 'Broadcast' : 'Confirm'}}</button>
        </ng-template>
      </div>
    </div>
  </div>
</div>